<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC 
"-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="adminMapper">

	<resultMap id="MemberResultSet" type="Member">
		<id property="mno" column="m_no"/>
		<result property="loginType" column="loginType"/>
		<result property="snsId" column="snsid"/>
		<result property="email" column="email"/>
		<result property="pass" column="pass"/>
		<result property="nickName" column="nickName"/>
		<result property="profile" column="profile"/>
		<result property="location" column="location"/>
		<result property="profileImg" column="profile_Img"/>
		<result property="profilePath" column="profile_Path"/>
		<result property="enrollDate" column="enroll_Date"/>
		<result property="updateDate" column="update_Date"/>
		<result property="deleteDate" column="delete_Date"/>
		<result property="isDelete" column="isDelete"/>
	</resultMap>
	
	<resultMap id="DeclareResultSet" type="Declare">
		<id property="dno" column="d_no"/>
		<result property="mno" column="m_no"/>
		<result property="bno" column="b_no"/>
		<result property="category" column="category"/>
		<result property="content" column="content"/>
		<result property="enrollDate" column="enroll_Date"/>
		<result property="isCheck" column="isCheck"/>
		<result property="type" column="type"/>
		<result property="email" column="email"/>
		<result property="bname" column="bname"/>
	</resultMap>
	
	<select id="getMemberListCount" resultType="_int">
		select count(*)
		from member
	</select>

	<select id="selectMemberList" resultMap="MemberResultSet">
		select rownum, m.* from
       ( select *
		from member
		order by delete_date desc ,enroll_date desc,m_no desc)m
	</select>
	
	<update id="deleteMember" parameterType="java.util.ArrayList">
		update Member
		set isdelete='Y', delete_date=sysdate
		where m_no in 
		<if test="list.size != 0">
		<foreach item="item" collection="list" index="index" separator="," open="(" close=")">
		#{item}
	    </foreach>
		</if>
	</update>
	
	<select id="getDeclareListCount" resultType="_int" parameterType="hashMap">
		select count(*)
		from declare
		<if test="posting != null">
			where type='1'
		</if>
		<if test="free != null">
			where type='2'
		</if>
	</select>
	
	<select id="selectDeclareList" resultMap="DeclareResultSet" parameterType="hashMap">
		select rownum, t4.* from
		(select t3.* from
		(select * from
		(select d.*,m.email,p.rename_img bname
		from declare d
		join member m on(m.m_no=d.m_no)
		join posting p on(p.p_no=d.b_no)
		where type=1) t1
		union
		select * from
		(select d.*,m.email,b.title
		from declare d
		join member m on(m.m_no=d.m_no)
		join board b on(b.b_no=d.b_no)
		where type=2) t2)
        t3
        <if test="posting != null">
			where type='1'
		</if>
		<if test="free != null">
			where type='2'
		</if>
        order by ischeck, enroll_date desc) t4
	</select>
	
	<update id="deleteDeclareBoard" parameterType="java.util.ArrayList">
		update declare
		set ischeck='3'
		where d_no in 
		<if test="list.size != 0">
		<foreach item="item" collection="list" index="index" separator="," open="(" close=")">
		#{item}
	    </foreach>
		</if>
	</update>

	
</mapper>